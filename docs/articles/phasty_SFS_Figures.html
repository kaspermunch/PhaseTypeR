<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using PhaseTypeR for the site frequency spectrum - Figures • PhaseTypeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using PhaseTypeR for the site frequency spectrum - Figures">
<meta property="og:description" content="PhaseTypeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PhaseTypeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/PhaseTypeR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/phasty_SFS.html">Using PhaseTypeR for the site frequency spectrum</a>
    </li>
    <li>
      <a href="../articles/phasty_SFS_Figures.html">Using PhaseTypeR for the site frequency spectrum - Figures</a>
    </li>
    <li>
      <a href="../articles/pop_gen_iker.html">Using PhaseTypeR for population genetics</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rivasiker/PhaseTypeR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="phasty_SFS_Figures_files/header-attrs-2.9.4/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using PhaseTypeR for the site frequency spectrum - Figures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rivasiker/PhaseTypeR/blob/master/vignettes/phasty_SFS_Figures.Rmd"><code>vignettes/phasty_SFS_Figures.Rmd</code></a></small>
      <div class="hidden name"><code>phasty_SFS_Figures.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h1>
<p>TODO: Check final references to paper.</p>
<p>Here we recreate the figures from the paper and give more example of how to use the phase-type representation of the block counting process.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rivasiker.github.io/PhaseTypeR/">PhaseTypeR</a></span><span class="op">)</span></code></pre></div>
<div id="figure-1" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-1" class="anchor"></a>1. Figure 1</h2>
<p>Consider first, the left figure of Figure 1. This displays the coefficients of for the site frequency spectrum for different unbiased estimators of the mutation rate <span class="math inline">\(\theta\)</span>. The coefficients of the H, L, Wattersons, pairwise and singleton estimators are given Section 1.1 of Asger <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2020</a>)</span>. The coefficients of the BLUE estimator are given by <span class="math display">\[\begin{eqnarray}
  \hat{\bc}=
  \frac{\bLambda^{-1}\bv}{\bv^{\ast}\;\bLambda^{-1}\bv}.
\end{eqnarray}\]</span> where <span class="math inline">\(\bLambda\)</span> is the covariance matrix of the site frequency spectrum, which, using formula XX in Asger <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2020</a>)</span> can be calculated in terms of the mean and covariance matrix of the underlying block counting process <span class="math display">\[\begin{align}
\Var \bZ = \lambda^2 \bSigma + \lambda \diag(\bmu)
\end{align}\]</span> The latter two are easily calculated:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span>
<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">bmu</span> <span class="op">=</span> <span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span>
<span class="va">bSigma</span> <span class="op">=</span> <span class="fu"><a href="../reference/var.html">var</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span></code></pre></div>
<p>Using these two quantities, the coefficients are calculated below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">thetaVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">100</span><span class="op">)</span>
<span class="va">bv</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">##BLUE Estimators</span>
<span class="va">coef_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">theta</span> <span class="op">=</span> <span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">bLambda</span><span class="op">=</span><span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="va">bSigma</span> <span class="op">+</span> <span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span> <span class="va">bmu</span> <span class="op">)</span>
  <span class="va">coef_matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span><span class="op">%*%</span><span class="va">bv</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bv</span><span class="op">%*%</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span><span class="op">%*%</span><span class="va">bv</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Wattersons estimator</span>
<span class="va">xWatt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span>
<span class="co">##-------------------------------------------------------------</span>
<span class="co">## Singleton estimator</span>
<span class="va">xsngltns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bv</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">##-------------------------------------------------------------</span>
<span class="co">## Pairwise difference estimator</span>
<span class="va">xpair</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span> <span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span>
<span class="co">##-------------------------------------------------------------</span>
<span class="co">## H estimator</span>
<span class="va">xH</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span><span class="fl">2</span><span class="op">/</span><span class="va">n</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="co">##-------------------------------------------------------------</span>
<span class="co">## L estimator</span>
<span class="va">xL</span> <span class="op">&lt;-</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="co">##---------------------------------------------------------------</span>
<span class="co">## Plot the coefficients of the 5 different estimators (W,S,P,H,L)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xWatt</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">2</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"black"</span>,lwd<span class="op">=</span><span class="fl">2</span>,type<span class="op">=</span><span class="st">"l"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>,ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="va">c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,cex.lab<span class="op">=</span><span class="fl">1.4</span>,lty<span class="op">=</span><span class="fl">2</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xsngltns</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xpair</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">4</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xH</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">5</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xL</span>,col<span class="op">=</span><span class="st">"black"</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">xhat</span> <span class="op">=</span> <span class="va">coef_matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">xhat</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">xhat</span><span class="op">[</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="va">theta</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,pos<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">txtVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Watterson"</span>,<span class="st">"Singleton"</span>,<span class="st">"Pairwise"</span>,<span class="st">"H"</span>,<span class="st">"L"</span>,<span class="st">"BLUE"</span><span class="op">)</span>
<span class="va">ltyVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">txtVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">ltyVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-3-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The right figure in Figure 1 displays the variances as a function of <span class="math inline">\(\theta\)</span> - these can be calculated as <span class="math inline">\(\bc^\ast \bLambda \bc\)</span>, where <span class="math inline">\(\bc\)</span> are the coefficients calculated above, and <span class="math inline">\(\bLambda\)</span> is the covariance of the site frequency spectrum as above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">thetaVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">2.5</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>
<span class="va">ntheta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span>
<span class="va">vrW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span>
<span class="va">vrH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> ; <span class="va">vrMVUE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ntheta</span><span class="op">)</span> 
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ntheta</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tht</span> <span class="op">&lt;-</span> <span class="va">thetaVec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">bLambda</span><span class="op">=</span><span class="op">(</span><span class="va">tht</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">*</span><span class="va">bSigma</span> <span class="op">+</span> <span class="op">(</span><span class="va">tht</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span> <span class="va">bmu</span> <span class="op">)</span>
  <span class="va">xhat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bv</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">bv</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bLambda</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bv</span><span class="op">)</span>
  <span class="va">vrMVUE</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xhat</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xhat</span>
  <span class="va">vrW</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xWatt</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xWatt</span>
  <span class="va">vrS</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xsngltns</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xsngltns</span>
  <span class="va">vrP</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xpair</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xpair</span>
  <span class="va">vrH</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xH</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xH</span>
  <span class="va">vrL</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">xL</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">bLambda</span> <span class="op">%*%</span> <span class="va">xL</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrMVUE</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">thetaVec</span><span class="op">)</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Variance for estimator"</span>,cex.lab<span class="op">=</span><span class="fl">1.4</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrW</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrS</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrP</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">4</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrH</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">5</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">thetaVec</span>,<span class="va">vrL</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="fl">6</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="va">indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,<span class="va">txtVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lty<span class="op">=</span><span class="va">ltyVec</span><span class="op">[</span><span class="va">indx</span><span class="op">]</span>,lwd<span class="op">=</span><span class="fl">2</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-4-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
<div id="simulation-and-characteristic-function" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-and-characteristic-function" class="anchor"></a>Simulation and characteristic function</h2>
<p>Here, we numerically invert the characteristic function of the numerator of Tajima’s <span class="math inline">\(D\)</span> and compare to simulated values. First, we obtain the rate-matrix and state space for the block counting process. First, we simulate using the results in XX Asger <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2020</a>)</span>, from which it follows that the site frequency spectrum can be simulated by first sampling a random variate from the appropriate block counting process, and letting the entries of this variate be the rates of independent Poisson random variables. First, we obtain the block counting process for <span class="math inline">\(n=4\)</span></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">4</span>
<span class="co"># create rate-matrix and state space for block counting process</span>
<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</span>

<span class="co"># Obtain subintensity matrix</span>
<span class="va">subintensity_matrix</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span>
<span class="va">rew_mat</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></code></pre></div>
<p>Next, we simulate random site frequency spectra by using REF.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R</span> <span class="op">=</span> <span class="fl">1e4</span>
<span class="va">ph_mv_sim_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_rew_phase_type.html">sim_rew_phase_type</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">ph_bcp</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">=</span> <span class="fl">0.5</span> <span class="co">#lambda = theta/2</span>
<span class="va">ph_counts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ph_counts</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">*</span><span class="va">ph_mv_sim_obj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The numerator of Tajima’s <span class="math inline">\(D\)</span> is <span class="math inline">\(\hat{\theta}_{\pi}-\hat{\theta}_{\rm W}\)</span> so the coefficient vector <span class="math inline">\(\mathbf{c}\)</span> is <span class="math display">\[
c_i = \frac{1}{\binom{n}{2}} i (n-i) - \frac{1}{\sum_{i=1}^{n-1} \frac{1}{i}}
\]</span></p>
<p>which is implemented below</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bc</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For numeric reasons, we scale the coefficients by 1000 and rescale later</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="va">bc</span> <span class="op">=</span> <span class="va">res</span><span class="op">*</span><span class="va">bc</span></code></pre></div>
<p>According to REF, the characteristic function is obtained as</p>
<p><span class="math display">\[
\phi(t) = G(\e^{\ih t})
\]</span></p>
<p>where <span class="math display">\[\begin{align*}
  G(z) = 
  \Exp [z^{\bc^\ast \bxi}] = 
  \Exp [z^{c_1 \xi_1} z^{c_2 \xi_2} \dots z^{c_{n-1} \xi_{n-1}}] =
  \be_1^\ast \left( \lambda \Delta[\bA (z^\bc - \be)] +\bT \right)^{-1} \bT \be
  =   \be_1^\ast \left( \bS + \lambda \Delta[\bA (z^\bc] \right)^{-1} \bT \be
\end{align*}\]</span> where <span class="math inline">\(\bT,\bA\)</span> being respectively the subintensity matrix and reward matrix of the block counting process, <span class="math inline">\(\bone = (1,1,\dots,1)^\ast\)</span> and <span class="math inline">\(\bS = \bT - \lambda \Delta \bA - \be\)</span>.</p>
<p>The next snippet implements the <span class="math inline">\(\phi\)</span>-function</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">themean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span><span class="op">)</span> <span class="co">#the mean of the linear combination (should be 0)</span>
<span class="va">bT</span> <span class="op">=</span> <span class="va">subintensity_matrix</span> <span class="co">#bold T</span>
<span class="va">bA</span> <span class="op">=</span> <span class="va">rew_mat</span> <span class="co">#bold A</span>
<span class="va">bS</span> <span class="op">=</span> <span class="va">bT</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold S</span>
<span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#bold one = (1,1,...,1)^T</span>
<span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>;<span class="va">balpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">1</span> <span class="co">#(1,0,...,0)</span>
<span class="va">phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1i</span><span class="op">*</span><span class="va">themean</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">balpha</span><span class="op">%*%</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bS</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bA</span><span class="op">%*%</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1i</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op">%*%</span><span class="va">bT</span><span class="op">%*%</span><span class="va">bone</span></code></pre></div>
<p>Finally, we approximate the CDF and rescale</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">appvals</span><span class="op">=</span><span class="fu"><a href="../reference/ApproxCDF.html">ApproxCDF</a></span><span class="op">(</span><span class="va">phi</span>,H <span class="op">=</span> <span class="fl">1e5</span>,eta<span class="op">=</span><span class="fl">0.0001</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">res</span>,<span class="fl">1.5</span><span class="op">*</span><span class="va">res</span><span class="op">)</span>,smoothe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">xvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">yvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="va">bc2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span>
<span class="va">xvals2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">xvals</span>
<span class="va">themean2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">themean</span>
<span class="va">centered_sim2</span> <span class="op">=</span> <span class="va">ph_counts</span><span class="op">%*%</span><span class="va">bc2</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">themean2</span><span class="op">)</span>
<span class="va">ecdfobj2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html">ecdf</a></span><span class="op">(</span><span class="va">centered_sim2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Cumulative distribution function"</span>,cex.lab<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">ecdfobj2</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.025</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.025</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.025</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.975</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.975</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0</span>, x1 <span class="op">=</span> <span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">&gt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.975</span>,lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co">#abline(h = 0.025,lty=3)</span>
<span class="co">#abline(h = 0.975,lty=3)</span>
<span class="co">#abline(v=xvals2[min(which(0.025&lt;yvals))],lty=2)</span>
<span class="co">#abline(v=xvals2[max(which(0.975&gt;yvals))],lty=2)</span>

<span class="va">xvals2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fl">0.025</span><span class="op">&lt;</span><span class="va">yvals</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] -0.2280796</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0.25</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-10-1.png" width="816" style="display: block; margin: auto;"></p>
<p>Next, we run the above code with <span class="math inline">\(n=8\)</span>.</p>
<pre><code>#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.
#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</code></pre>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-11-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
<div id="figure-4" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-4" class="anchor"></a>Figure 4</h2>
<p>In this section we recreate the bottom two sub-figures of Figure 4, and first we consider the bottom left figure, which displays the CDFs of the <span class="math inline">\(i\)</span>-ton branch-length for <span class="math inline">\(i = 1,2,3,4\)</span>. As described in Section 3, these branch-lengths all have (possibly defective) <span class="math inline">\(PH\)</span> distributions, whose subintensity matrix (and possible defect) can be calculated from the subintensity matrix and state-space of the block-counting process, so first compute these two objects:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">5</span>

<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</span>

<span class="va">subintensity_matrix</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span>
<span class="va">rew_mat</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span></code></pre></div>
<p>The reward matrix (which also represents the state-space of the block-counting process) is</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rew_mat</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4]</span>
<span class="co">#&gt; [1,]    5    0    0    0</span>
<span class="co">#&gt; [2,]    3    1    0    0</span>
<span class="co">#&gt; [3,]    2    0    1    0</span>
<span class="co">#&gt; [4,]    1    2    0    0</span>
<span class="co">#&gt; [5,]    1    0    0    1</span>
<span class="co">#&gt; [6,]    0    1    1    0</span></code></pre></div>
<p>As we see, the first column of the state-space matrix, <span class="math inline">\(\br = (5,3,2,1,1,0)^\ast\)</span>, then corresponds to the rewards which give rise to the singleton branch-lengths, which can then be generated as</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/phase_type.html">phase_type</a></span><span class="op">(</span><span class="va">subintensity_matrix</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="va">ph_rew_obj</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="va">rew_mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The code below generates the phase type distribution of the <span class="math inline">\(i\)</span>-ton branches and their CDFs using the formula (TODO: REF)</p>
<p><span class="math display">\[
1 - F(t)= \Prob (\tau&gt;t) = 1- \balpha e^{\bS t}\bone, 
\]</span> The code below plots the four distributions functions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"n"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="st">"t"</span>,ylab<span class="op">=</span><span class="st">"Cumulative distribution function"</span>,cex.lab<span class="op">=</span><span class="fl">1.4</span>,
     main<span class="op">=</span><span class="st">"Branch length distributions for i-tons with sample size n=5"</span>,las<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ph_rew_obj</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="va">rew_mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>
  <span class="va">abstime</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">{</span>
    <span class="fl">1</span> <span class="op">-</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span><span class="op">%*%</span><span class="fu">expm</span><span class="op">(</span><span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">*</span><span class="va">u</span><span class="op">)</span><span class="op">%*%</span><span class="va">bone</span>
  <span class="op">}</span>
  <span class="va">abstime</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span><span class="op">(</span><span class="va">abstime</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="va">abstime</span>,lty<span class="op">=</span><span class="va">i</span>,add<span class="op">=</span><span class="cn">TRUE</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"singleton"</span>,<span class="st">"doubleton"</span>,<span class="st">"tripleton"</span>,<span class="st">"quardrupleton"</span><span class="op">)</span>,
       lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-15-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The the bottom right plot of Figure 4, we find the point probabilities of <span class="math inline">\(i\)</span> mutations <span class="math inline">\(i=1,\dots,4\)</span> corresponding to Phase-type distributions of the bottom left figure. These are easily computed using Theorem 2.3 which in this case has the interpretation, that adding mutations to branches whose length is <span class="math inline">\(PH\)</span>-distributed, gives a <span class="math inline">\(DPH\)</span> distribution, whose sub-transition matrix is given by</p>
<p><span class="math display">\[\begin{equation}
   \bM=\Big(\bI-\frac{2}{\theta} \bS\Big)^{-1}.  \tag{$\spadesuit$}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\bS\)</span> is the sub-transition matrix of the underlying phase-type distribution.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fl">1</span>, type<span class="op">=</span><span class="st">"n"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">"Number of mutations"</span>,ylab<span class="op">=</span><span class="st">"Probability"</span>,
     main<span class="op">=</span><span class="st">"Probability of mutations for theta=1"</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ph_rew_obj</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="va">rew_mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">bS</span> <span class="op">=</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span>
  <span class="va">bM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">bS</span><span class="op">)</span>
  <span class="va">bpi</span> <span class="op">=</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">init_probs</span>
  <span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bm</span> <span class="op">=</span> <span class="va">bone</span> <span class="op">-</span> <span class="va">bM</span><span class="op">%*%</span><span class="va">bone</span>
  <span class="va">probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">bpi</span><span class="op">%*%</span><span class="op">(</span><span class="va">bM</span><span class="op">%^%</span><span class="va">i</span><span class="op">)</span><span class="op">%*%</span><span class="va">bm</span><span class="op">)</span>
  <span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">defect</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,<span class="va">probs</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,<span class="va">probs</span>,lty<span class="op">=</span><span class="va">i</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"singleton"</span>,<span class="st">"doubleton"</span>,<span class="st">"tripleton"</span>,<span class="st">"quardrupleton"</span><span class="op">)</span>,
       lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.3</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-16-1.png" width="816" style="display: block; margin: auto;"></p>
</div>
<div id="figure-6" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-6" class="anchor"></a>Figure 6</h2>
<p>Figure 6 displays the point probabilities of the three integer–weighted estimators for <span class="math inline">\(\theta\)</span> (<span class="math inline">\(\hat{\theta}_{\pi}, \hat{\theta}_H\)</span> and <span class="math inline">\(\hat{\theta}_L\)</span> for <span class="math inline">\(n=4\)</span> and <span class="math inline">\(n=6\)</span>. First, we consider the left sub-figure, i.e. <span class="math inline">\(n=4\)</span>. The three estimators are all integer-weighted versions of the site frequency spectrum, i.e., of the form <span class="math inline">\(\ba^\ast \bxi = a_1 \xi_1 + a_2 \xi_2 + \dots + a_{n-1} \xi_{n-1}\)</span>, where the <span class="math inline">\(a_i\)</span>s are integers. As described in section 4.1 of Hobolth <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2020</a>)</span>, these estimators have a <span class="math inline">\(DPH\)</span> distribution, whose subtransition matrix is constructed using the entries of (<span class="math inline">\(\spadesuit\)</span>), so we first, calculate the latter:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">theta</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</span>

<span class="va">subintensity_matrix</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span>
<span class="va">rew_mat</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>

<span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/phase_type.html">phase_type</a></span><span class="op">(</span><span class="va">subintensity_matrix</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>

<span class="co"># The reward vector is the rows sums of the state space matrix</span>

<span class="va">ph_rew_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">rew_mat</span><span class="op">)</span><span class="op">)</span>
<span class="va">bS</span> <span class="op">=</span> <span class="va">ph_rew_obj</span><span class="op">$</span><span class="va">subint_mat</span>

<span class="va">bM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="va">theta</span><span class="op">)</span><span class="op">*</span><span class="va">bS</span><span class="op">)</span></code></pre></div>
<p>Next, we define the three <span class="math inline">\(\ba\)</span> vectors of coefficients. These are <span class="math inline">\((1,2,3)\)</span> , <span class="math inline">\((3,4,3)\)</span> and <span class="math inline">\((1,4,9)\)</span> for <span class="math inline">\((\hat{\theta}_L)\)</span>,<span class="math inline">\((\hat{\theta}_{\pi})\)</span> and <span class="math inline">\((\hat{\theta}_{H})\)</span> respectively.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baMat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">n</span><span class="op">-</span><span class="fl">1</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">baMat</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]    1    2    3</span>
<span class="co">#&gt; [2,]    3    4    3</span>
<span class="co">#&gt; [3,]    1    4    9</span></code></pre></div>
<p>Next, we proceed with the construction as described in section 4.1 of Asger <span class="citation">(<a href="#ref-asgertemp2020" role="doc-biblioref">2020</a>)</span> (TODO and Chap XX)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">len</span> <span class="op">=</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>
<span class="va">probsMat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span>,<span class="va">len</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i_outer</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ba</span> <span class="op">=</span> <span class="va">baMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="co">#This is the current a-vector</span>
  <span class="va">DPH_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/DPHrep.html">DPHrep</a></span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span>
  <span class="va">bMt</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">sizes_of_blocks</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="va">balpha</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span> 
  <span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bmt</span> <span class="op">=</span> <span class="va">bone</span> <span class="op">-</span> <span class="va">bMt</span><span class="op">%*%</span><span class="va">bone</span>
  <span class="va">probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">probs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">balpha</span><span class="op">%*%</span><span class="op">(</span><span class="va">bMt</span><span class="op">%^%</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">%*%</span><span class="va">bmt</span>
  <span class="op">}</span>
  <span class="va">probsMat</span><span class="op">[</span><span class="va">i_outer</span>,<span class="op">]</span> <span class="op">=</span> <span class="va">probs</span>
<span class="op">}</span>
<span class="co">#Finally, plot the figures</span>
<span class="va">main.txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">"Integer-weighted SFS distributions for n"</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">~</span><span class="st">"and"</span><span class="op">~</span><span class="va">theta</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>

<span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dashed"</span>,pch<span class="op">=</span><span class="fl">19</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Weighted SFS"</span>,ylab<span class="op">=</span><span class="st">"Probability"</span>,
     main<span class="op">=</span><span class="va">main.txt</span>,cex.main<span class="op">=</span><span class="fl">1.2</span>,cex.lab<span class="op">=</span><span class="fl">1.2</span>,las<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span>

<span class="va">xs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dotted"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"solid"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"p"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span>
<span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">~</span><span class="va">theta</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">probsMat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">txt</span>,pos<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pairwise"</span>,<span class="st">"H"</span>,<span class="st">"L"</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span>,
       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"solid"</span>,<span class="st">"dashed"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-19-1.png" width="816" style="display: block; margin: auto;"></p>
<p>The figure for <span class="math inline">\(n=6\)</span> is created in a similar fashion</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">##### THE FOLLOWING CODE DOES NOT RUN FOR R-DEVEL #####</span>

<span class="co"># n = 6</span>
<span class="co"># theta = 1</span>
<span class="co"># ph_bcp = block_counting_process(n)</span>
<span class="co"># </span>
<span class="co"># subintensity_matrix = ph_bcp$subint_mat</span>
<span class="co"># rew_mat = ph_bcp$reward_mat</span>
<span class="co"># </span>
<span class="co"># ph = phase_type(subintensity_matrix)</span>
<span class="co"># </span>
<span class="co"># # The reward vector is the rows sums of the state space matrix</span>
<span class="co"># </span>
<span class="co"># ph_rew_obj = reward_phase_type(ph, rowSums(rew_mat))</span>
<span class="co"># bS = ph_rew_obj$subint_mat</span>
<span class="co"># </span>
<span class="co"># bM = solve(diag(dim(bS)[1])-(2/theta)*bS)</span>
<span class="co"># </span>
<span class="co"># baMat = matrix(c(1:(n-1),(1:(n-1))*((n-1):1),(1:(n-1))^2),n-1,n-1,byrow=TRUE)</span>
<span class="co"># </span>
<span class="co"># len = n*(n-1)+1</span>
<span class="co"># probsMat = matrix(0,3,len)</span>
<span class="co"># </span>
<span class="co"># for(i_outer in 1:3) {</span>
<span class="co">#   ba = baMat[i_outer,] #This is the current a-vector</span>
<span class="co">#   DPH_obj = DPHrep(bM,ph_bcp$reward_mat,ba)</span>
<span class="co">#   bMt = DPH_obj[[1]]</span>
<span class="co">#   sizes_of_blocks = DPH_obj[[2]]</span>
<span class="co">#   balpha = rep(0,dim(bMt)[1])</span>
<span class="co">#   balpha[sizes_of_blocks[1]] = 1 </span>
<span class="co">#   bone = matrix(rep(1,dim(bMt)[1]))</span>
<span class="co">#   bmt = bone - bMt%*%bone</span>
<span class="co">#   probs = rep(0,len)</span>
<span class="co">#   for(i in 1:len) {</span>
<span class="co">#     probs[i] = balpha%*%(bMt%^%(i-1))%*%bmt</span>
<span class="co">#   }</span>
<span class="co">#   probsMat[i_outer,] = probs</span>
<span class="co"># }</span>
<span class="co"># </span>
<span class="co"># xs = c(0,(1:(2*(n-1)))/(n-1))</span>
<span class="co"># </span>
<span class="co"># main.txt &lt;- paste("Integer-weighted SFS distributions for n=",n,"and theta=",1)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># plot(xs,probsMat[1,1:(2*(n-1)+1)],type="l",lty="dashed",pch=19,ylim=c(0,probsMat[1,1]),xlab="Weighted SFS",ylab="Probability",</span>
<span class="co">#      main=main.txt,cex.main=1.2,cex.lab=1.2,las=1,lwd=2)</span>
<span class="co"># points(xs,probsMat[1,1:(2*(n-1)+1)],type="p",pch=19)</span>
<span class="co"># </span>
<span class="co"># xs = c(0,(1:((n*(n-1))))/(n*(n-1)/2))</span>
<span class="co"># points(xs,probsMat[2,],type="l",lty="dotted",lwd=2)</span>
<span class="co"># points(xs,probsMat[2,],type="p",pch=19)</span>
<span class="co"># points(xs,probsMat[3,],type="l",lty="solid",lwd=2)</span>
<span class="co"># points(xs,probsMat[3,],type="p",pch=19)</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># xs = c(0,(1:(2*(n-1)))/(n-1))</span>
<span class="co"># </span>
<span class="co"># abline(v=1,col="gray")</span>
<span class="co"># txt &lt;- paste("mean=theta=",1)</span>
<span class="co"># text(1,probsMat[1,1],txt,pos=2,cex=1.2)</span>
<span class="co"># </span>
<span class="co"># legend("topright",c("Pairwise","H","L"),lwd=2,</span>
<span class="co">#        lty=c("dotted","solid","dashed"),bty="n",cex=1.2)</span></code></pre></div>
</div>
</div>
<div id="last-figure" class="section level1">
<h1 class="hasAnchor">
<a href="#last-figure" class="anchor"></a>Last Figure</h1>
<p>Compute CDF from the first figure</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span>
<span class="va">lambda</span> <span class="op">=</span> <span class="fl">0.5</span>
<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</span>

<span class="va">ph_mv_sim_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_rew_phase_type.html">sim_rew_phase_type</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">ph_bcp</span><span class="op">)</span>

<span class="va">ph_counts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ph_counts</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">*</span><span class="va">ph_mv_sim_obj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Obtain subintensity matrix</span>
<span class="va">subintensity_matrix</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span>

<span class="va">rew_mat</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>

<span class="co">#bc = xWatt</span>
<span class="va">bc</span> <span class="op">=</span> <span class="va">coef_matrix</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="co">#coef_matrix was generated above, its rows correspond to the entries of thetavec, second entry is theta = 1</span>
<span class="va">res</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="va">bc</span> <span class="op">=</span> <span class="va">res</span><span class="op">*</span><span class="va">bc</span>
<span class="co">#compute characteristic function</span>
<span class="va">themean</span> <span class="op">=</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span><span class="op">)</span> <span class="co">#the mean of the linear combination</span>
<span class="va">bT</span> <span class="op">=</span> <span class="va">subintensity_matrix</span> <span class="co">#bold T</span>
<span class="va">bA</span> <span class="op">=</span> <span class="va">rew_mat</span> <span class="co">#bold A</span>
<span class="va">bS</span> <span class="op">=</span> <span class="va">bT</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold S</span>
<span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#bold one = (1,1,...,1)^T</span>
<span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>;<span class="va">balpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">1</span> <span class="co">#(1,0,...,0)</span>

<span class="va">phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1i</span><span class="op">*</span><span class="va">themean</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">balpha</span><span class="op">%*%</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bS</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bA</span><span class="op">%*%</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1i</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op">%*%</span><span class="va">bT</span><span class="op">%*%</span><span class="va">bone</span>

<span class="co">#Invert numerically</span>
<span class="va">appvals</span><span class="op">=</span><span class="fu"><a href="../reference/ApproxCDF.html">ApproxCDF</a></span><span class="op">(</span><span class="va">phi</span>,H <span class="op">=</span> <span class="fl">1e5</span>,eta<span class="op">=</span><span class="fl">0.0001</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span><span class="op">*</span><span class="va">res</span>,<span class="fl">4</span><span class="op">*</span><span class="va">res</span><span class="op">)</span>,smoothe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">xvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">yvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="va">bc2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span>
<span class="va">xvals2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">xvals</span>
<span class="va">themean2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">themean</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>

<span class="co">#Compute point probabilities of Wattersons Theta</span>

<span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/phase_type.html">phase_type</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(ph_bcp$subint_mat): The initial probability vector is automatically generated.</span>
<span class="va">watter</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span><span class="op">)</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">=</span> <span class="fl">0.5</span>

<span class="va">bM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">lambda</span><span class="op">)</span><span class="op">*</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span>
<span class="va">bm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bM</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">bM</span><span class="op">)</span>

<span class="va">a1</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#"normalizing" constant, in Wattersons theta</span>
<span class="va">len</span> <span class="op">=</span> <span class="fl">17</span> <span class="co">#number of points to include</span>

<span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span> 
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">ph</span><span class="op">$</span><span class="va">init_probs</span><span class="op">%*%</span><span class="op">(</span><span class="va">bM</span><span class="op">%^%</span><span class="va">i</span><span class="op">)</span><span class="op">%*%</span><span class="va">bm</span>
<span class="op">}</span>


<span class="va">wx</span><span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">a1</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Possible values for Wattersons Theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span><span class="op">(</span><span class="va">wx</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">out</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-21-1.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#Pairwise estimator - note that this estimator re-uses the bM-matrix above.</span>

<span class="va">ba</span> <span class="op">=</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span> <span class="op">)</span> <span class="co">#Coefficients of pair-wise estimator</span>
<span class="va">DPH_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/DPHrep.html">DPHrep</a></span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span>
<span class="va">bMt</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">sizes_of_blocks</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">balpha</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span> 
<span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">bmt</span> <span class="op">=</span> <span class="va">bone</span> <span class="op">-</span> <span class="va">bMt</span><span class="op">%*%</span><span class="va">bone</span>

<span class="co">#table(ph_counts%*%ba)/R</span>
<span class="va">len</span> <span class="op">=</span> <span class="fl">250</span>

<span class="co"># Running bMt - the bMt is pretty large, computing its matrix-powers in the naive way as above is time-consuming.</span>
<span class="va">probs2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span>
<span class="va">run_bMT</span> <span class="op">=</span> <span class="va">balpha</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">probs2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">run_bMT</span><span class="op">%*%</span><span class="va">bmt</span>
  <span class="va">run_bMT</span> <span class="op">=</span> <span class="va">run_bMT</span><span class="op">%*%</span><span class="va">bMt</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">probs2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-21-2.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">a1</span> <span class="op">=</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="co">#Normalizing constant of the pairwise estimator</span>
<span class="va">wx</span><span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">a1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span><span class="op">(</span><span class="va">wx</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probs2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-21-3.png" width="816" style="display: block; margin: auto;"></p>
<p>Very last figure</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">10</span>
<span class="va">lambda</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">ph_bcp</span> <span class="op">=</span> <span class="fu"><a href="../reference/block_counting_process.html">block_counting_process</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix): The initial probability vector is automatically generated.</span>
<span class="co">#&gt; Warning in phase_type(subintensity_matrix, reward_mat = rew_mat): The initial probability vector is automatically generated.</span>

<span class="va">ph_mv_sim_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_rew_phase_type.html">sim_rew_phase_type</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">ph_bcp</span><span class="op">)</span>

<span class="va">ph_counts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ph_mv_sim_obj</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">R</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ph_counts</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">*</span><span class="va">ph_mv_sim_obj</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">subintensity_matrix</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span>

<span class="va">rew_mat</span> <span class="op">=</span> <span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>

<span class="va">bc</span> <span class="op">=</span> <span class="va">coef_matrix</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span> <span class="co">#coef_matrix was generated above, its rows correspond to the entries of thetavec, fourth entry is theta = 10</span>
<span class="va">res</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="va">bc</span> <span class="op">=</span> <span class="va">res</span><span class="op">*</span><span class="va">bc</span>
<span class="co">#compute characteristic function</span>
<span class="va">themean</span> <span class="op">=</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean.html">mean</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span><span class="op">)</span> <span class="co">#the mean of the linear combination</span>
<span class="va">bT</span> <span class="op">=</span> <span class="va">subintensity_matrix</span> <span class="co">#bold T</span>
<span class="va">bA</span> <span class="op">=</span> <span class="va">rew_mat</span> <span class="co">#bold A</span>
<span class="va">bS</span> <span class="op">=</span> <span class="va">bT</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">bA</span><span class="op">)</span><span class="op">)</span> <span class="co">#bold S</span>
<span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#bold one = (1,1,...,1)^T</span>
<span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bT</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>;<span class="va">balpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fl">1</span> <span class="co">#(1,0,...,0)</span>

<span class="va">phi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1i</span><span class="op">*</span><span class="va">themean</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">balpha</span><span class="op">%*%</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">bS</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bA</span><span class="op">%*%</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1i</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">^</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span><span class="op">%*%</span><span class="va">bT</span><span class="op">%*%</span><span class="va">bone</span>

<span class="co">#Invert numerically</span>
<span class="va">appvals</span><span class="op">=</span><span class="fu"><a href="../reference/ApproxCDF.html">ApproxCDF</a></span><span class="op">(</span><span class="va">phi</span>,H <span class="op">=</span> <span class="fl">1e5</span>,eta<span class="op">=</span><span class="fl">0.0001</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span><span class="op">*</span><span class="va">res</span>,<span class="fl">10</span><span class="op">*</span><span class="va">res</span><span class="op">)</span>,smoothe<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">xvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">yvals</span><span class="op">=</span><span class="va">appvals</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="va">bc2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">bc</span>
<span class="va">xvals2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">xvals</span>
<span class="va">themean2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">res</span><span class="op">)</span><span class="op">*</span><span class="va">themean</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>

<span class="co">#Compute point probabilities of Wattersons Theta for theta = 10</span>

<span class="va">ph</span> <span class="op">=</span> <span class="fu"><a href="../reference/phase_type.html">phase_type</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span>
<span class="co">#&gt; Warning in phase_type(ph_bcp$subint_mat): The initial probability vector is automatically generated.</span>
<span class="va">watter</span><span class="op">=</span><span class="fu"><a href="../reference/reward_phase_type.html">reward_phase_type</a></span><span class="op">(</span><span class="va">ph</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span><span class="op">)</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">=</span> <span class="fl">5</span>

<span class="va">bM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">lambda</span><span class="op">)</span><span class="op">*</span><span class="va">watter</span><span class="op">$</span><span class="va">subint_mat</span><span class="op">)</span>
<span class="va">bm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bM</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">bM</span><span class="op">)</span>

<span class="va">a1</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#"normalizing" constant, in Wattersons theta</span>
<span class="va">len</span> <span class="op">=</span> <span class="fl">250</span> <span class="co">#number of points to include</span>

<span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span> 
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">ph</span><span class="op">$</span><span class="va">init_probs</span><span class="op">%*%</span><span class="op">(</span><span class="va">bM</span><span class="op">%^%</span><span class="va">i</span><span class="op">)</span><span class="op">%*%</span><span class="va">bm</span>
<span class="op">}</span>

<span class="va">wx</span><span class="op">=</span><span class="op">-</span><span class="fl">10</span><span class="op">+</span><span class="va">a1</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Possible values for Wattersons Theta</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span><span class="op">(</span><span class="va">wx</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">out</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-22-1.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="st">"Pairwise estimator for theta = 10"</span>
<span class="co">#&gt; [1] "Pairwise estimator for theta = 10"</span>

<span class="va">ba</span> <span class="op">=</span> <span class="op">(</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">*</span><span class="op">(</span> <span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span> <span class="op">)</span> <span class="co">#Coefficients of pair-wise estimator</span>
<span class="va">DPH_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/DPHrep.html">DPHrep</a></span><span class="op">(</span><span class="va">bM</span>,<span class="va">ph_bcp</span><span class="op">$</span><span class="va">reward_mat</span>,<span class="va">ba</span><span class="op">)</span>
<span class="va">bMt</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">sizes_of_blocks</span> <span class="op">=</span> <span class="va">DPH_obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="va">balpha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">balpha</span><span class="op">[</span><span class="va">sizes_of_blocks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span> 
<span class="va">bone</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">bMt</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">bmt</span> <span class="op">=</span> <span class="va">bone</span> <span class="op">-</span> <span class="va">bMt</span><span class="op">%*%</span><span class="va">bone</span>

<span class="co">#table(ph_counts%*%ba)/R</span>
<span class="va">len</span> <span class="op">=</span> <span class="fl">1e3</span>

<span class="co"># Running bMt - the bMt is pretty large, computing its matrix-powers in the naive way as above is time-consuming.</span>
<span class="va">probs2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">len</span><span class="op">)</span>
<span class="va">run_bMT</span> <span class="op">=</span> <span class="va">balpha</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">len</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">probs2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">run_bMT</span><span class="op">%*%</span><span class="va">bmt</span>
  <span class="va">run_bMT</span> <span class="op">=</span> <span class="va">run_bMT</span><span class="op">%*%</span><span class="va">bMt</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">probs2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-22-2.png" width="816" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="va">a1</span> <span class="op">=</span> <span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="co">#Normalizing constant of the pairwise estimator</span>
<span class="va">wx</span><span class="op">=</span><span class="op">-</span><span class="fl">10</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">a1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">len</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stepfun.html">stepfun</a></span><span class="op">(</span><span class="va">wx</span>,<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">probs2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,do.points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">xvals2</span>,<span class="va">yvals</span>,type<span class="op">=</span><span class="st">"l"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="phasty_SFS_Figures_files/figure-html/unnamed-chunk-22-3.png" width="816" style="display: block; margin: auto;"></p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-asgertemp2020" class="csl-entry">
Hobolth, A, M. Bladt, and L. A. Andersen. 2020. <span>“Multivariate Phase-Type Theory for the Site Frequency Spectrum.”</span>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iker Rivas-González, Colin Guetemme, Asger Hobolth, Lars Nørvang Andersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
